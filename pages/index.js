import Head from 'next/head';
import SliceZone from 'next-slicezone';

import Client, { manageLocal } from '../utils/prismicHelpers';
import * as Slices from '../slices';
import Layout from '../components/layout';

export default function Home({ doc, layout }) {
  return (
    <Layout data={layout.data} altLangs={doc.alternate_languages}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      {doc?.data && (
        <SliceZone slices={doc.data.slices} resolver={({ sliceName }) => Slices[sliceName]} />
      )}
    </Layout>
  );
}

export async function getStaticProps({ locale, locales }) {
  const fetchLinks = `project.customer, project.title, project.extract, project.image, project.technologies, project.link`;
  const doc = await Client().getSingle('homepage', { fetchLinks, lang: locale });
  const layout = (await Client().getSingle('layout', { lang: locale })) || {};

  const { currentLang, isMyMainLanguage } = manageLocal(locales, locale);

  return {
    props: {
      doc,
      layout,
      lang: {
        currentLang,
        isMyMainLanguage,
      },
    },
  };
}
